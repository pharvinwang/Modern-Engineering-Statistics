# W1_engineering_uncertainty.py

import streamlit as st
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

st.set_page_config(layout="wide")
st.title("ç¬¬ 1 é€±ï½œå·¥ç¨‹ä¸–ç•Œçš„ä¸ç¢ºå®šæ€§")
st.caption("ğŸ“˜ å°æ‡‰æ•™ç§‘æ›¸ï¼šç¬¬ 1 ç« ï¼ˆåƒ…æ¦‚å¿µï¼Œéå…¬å¼ï¼‰")

st.markdown("""
å·¥ç¨‹çµ±è¨ˆä¸æ˜¯ç‚ºäº†ç®—æ•¸å­¸ï¼Œ  
è€Œæ˜¯ç‚ºäº†åœ¨ **è³‡æ–™æœ‰é™ã€ä¸ç¢ºå®šå­˜åœ¨** çš„æƒ…æ³ä¸‹ï¼Œ  
å¹«åŠ©å·¥ç¨‹å¸«åšæ±ºç­–ã€‚
""")

# -------------------------------------------------
# A. å·¥ç¨‹æ¡ˆä¾‹é¸æ“‡
# -------------------------------------------------
st.subheader("ä¸€ã€å·¥ç¨‹æƒ…å¢ƒ")

case = st.selectbox(
    "é¸æ“‡å·¥ç¨‹æ¡ˆä¾‹",
    ["å¡åœ°ä½ç§»ç›£æ¸¬", "å–®å ´é™é›¨äº‹ä»¶", "æ–½å·¥å“è³ªæª¢æ¸¬"]
)

# å…§å»ºè³‡æ–™ï¼ˆç¤ºæ„ï¼Œå¯æ›¿æ›ç‚ºä½ å¯¦éš›è³‡æ–™ï¼‰
np.random.seed(42)

if case == "å¡åœ°ä½ç§»ç›£æ¸¬":
    true_mean = 2.0
    unit = "mm"
elif case == "å–®å ´é™é›¨äº‹ä»¶":
    true_mean = 120
    unit = "mm"
else:
    true_mean = 95
    unit = "%"

population = np.random.normal(true_mean, true_mean * 0.15, 1000)

# -------------------------------------------------
# B. å¯å–å¾—è³‡æ–™é‡ï¼ˆæ¨£æœ¬ï¼‰
# -------------------------------------------------
st.subheader("äºŒã€ä½ å¯¦éš›èƒ½é‡åˆ°å¤šå°‘è³‡æ–™ï¼Ÿ")

sample_size = st.slider(
    "å¯å–å¾—æ¨£æœ¬æ•¸ï¼ˆå·¥ç¨‹ç¾å ´é™åˆ¶ï¼‰",
    min_value=3,
    max_value=100,
    value=10
)

sample = np.random.choice(population, sample_size, replace=False)

# -------------------------------------------------
# C. çµ±è¨ˆçµæœèˆ‡è¦–è¦ºåŒ–
# -------------------------------------------------
st.subheader("ä¸‰ã€ä½ çœ‹åˆ°çš„å·¥ç¨‹ä¸–ç•Œ")

col1, col2 = st.columns(2)

with col1:
    st.metric("æ¨£æœ¬å¹³å‡å€¼", f"{sample.mean():.2f} {unit}")
    st.metric("æœ€å¤§å€¼", f"{sample.max():.2f} {unit}")

with col2:
    fig, ax = plt.subplots()
    ax.hist(sample, bins=10)
    ax.set_title("ä½ å¯¦éš›é‡åˆ°çš„è³‡æ–™")
    st.pyplot(fig)

# -------------------------------------------------
# D. å·¥ç¨‹æ±ºç­–åæ€ï¼ˆæœ€é‡è¦ï¼‰
# -------------------------------------------------
st.subheader("å››ã€å·¥ç¨‹æ±ºç­–åæ€")

st.warning(f"""
ä½ ç¾åœ¨æ‰‹ä¸Šçš„è³‡æ–™åªæœ‰ **{sample_size} ç­†**ã€‚

å¦‚æœä½ ç”¨æ¨£æœ¬å¹³å‡å€¼ **{sample.mean():.2f} {unit}**  
ä½œç‚ºè¨­è¨ˆæˆ–åˆ¤æ–·ä¾æ“šï¼š

- ä½ è¦ºå¾—é€™å€‹å€¼ç©©å®šå—ï¼Ÿ
- æ›ä¸€æ‰¹è³‡æ–™ï¼Œçµè«–æœƒä¸æœƒä¸ä¸€æ¨£ï¼Ÿ
- ä½ æ•¢ä¸æ•¢ç‚ºé€™å€‹åˆ¤æ–·è² è²¬ï¼Ÿ
""")

st.info("""
ğŸ“Œ ä»Šå¤©ä½ ä¸éœ€è¦æœƒä»»ä½•å…¬å¼ã€‚  
ğŸ“Œ ä½ åªè¦è¨˜ä½ä¸€ä»¶äº‹ï¼š

**å·¥ç¨‹çµ±è¨ˆçš„å­˜åœ¨ï¼Œæ˜¯å› ç‚ºå·¥ç¨‹ä¸–ç•Œä¸ç¢ºå®šã€‚**
""")
