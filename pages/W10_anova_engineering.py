# W10_anova_engineering.py

import streamlit as st
import numpy as np
import matplotlib.pyplot as plt
from scipy.stats import f_oneway

st.set_page_config(layout="wide")
st.title("ç¬¬ 10 é€±ï½œè®Šç•°æ•¸åˆ†æï¼šå¤šæ–¹æ¡ˆå·¥ç¨‹æ¯”è¼ƒ")
st.caption("ğŸ“˜ æ•™ç§‘æ›¸ç¬¬ 9 ç« ï¼ˆ9.1â€“9.4ï¼‰")

st.markdown("""
å·¥ç¨‹ç¾å ´å¾ˆå°‘åªæœ‰å…©å€‹æ–¹æ¡ˆã€‚

ğŸ‘‰ æ’æ°´é…ç½® Aã€Bã€C  
ğŸ‘‰ ææ–™ä¾†æº 1ã€2ã€3  
ğŸ‘‰ æ–½å·¥å·¥æ³•ç”²ã€ä¹™ã€ä¸™  

é€™æ™‚å€™ï¼Œä¸€å€‹ä¸€å€‹åš t æª¢å®šæ˜¯ä¸å°çš„ã€‚
""")

# =================================================
# A. å·¥ç¨‹æƒ…å¢ƒ
# =================================================
st.subheader("ä¸€ã€å·¥ç¨‹æ¯”è¼ƒæƒ…å¢ƒ")

case = st.selectbox(
    "é¸æ“‡å·¥ç¨‹æ¡ˆä¾‹",
    ["å¡åœ°æ’æ°´é…ç½®æ¯”è¼ƒ", "ä¸åŒå·¥æ³•æ–½å·¥æ™‚é–“", "ææ–™ä¾†æºå“è³ªå·®ç•°"]
)

np.random.seed(42)

# =================================================
# B. æ¨¡æ“¬å·¥ç¨‹è³‡æ–™
# =================================================
if case == "å¡åœ°æ’æ°´é…ç½®æ¯”è¼ƒ":
    unit = "mm"
    group_A = np.random.normal(3.2, 0.4, 20)
    group_B = np.random.normal(2.9, 0.4, 20)
    group_C = np.random.normal(2.5, 0.4, 20)
    ylabel = "å¡é¢ä½ç§»"

elif case == "ä¸åŒå·¥æ³•æ–½å·¥æ™‚é–“":
    unit = "åˆ†é˜"
    group_A = np.random.normal(30, 3, 25)
    group_B = np.random.normal(27, 3, 25)
    group_C = np.random.normal(26, 3, 25)
    ylabel = "æ–½å·¥æ™‚é–“"

else:
    unit = "åˆæ ¼ç‡"
    group_A = np.random.normal(0.88, 0.03, 30)
    group_B = np.random.normal(0.91, 0.03, 30)
    group_C = np.random.normal(0.93, 0.03, 30)
    ylabel = "å“è³ªæŒ‡æ¨™"

# =================================================
# C. é¡¯è‘—æ°´æº–
# =================================================
st.subheader("äºŒã€é¡¯è‘—æ°´æº–")

alpha = st.selectbox("é¡¯è‘—æ°´æº– Î±", [0.10, 0.05, 0.01], index=1)

# =================================================
# D. è¦–è¦ºåŒ–åŸå§‹è³‡æ–™
# =================================================
st.subheader("ä¸‰ã€å·¥ç¨‹è³‡æ–™è¦–è¦ºåŒ–")

fig1, ax1 = plt.subplots()
ax1.boxplot([group_A, group_B, group_C], labels=["æ–¹æ¡ˆ A", "æ–¹æ¡ˆ B", "æ–¹æ¡ˆ C"])
ax1.set_ylabel(f"{ylabel} ({unit})")
ax1.set_title("å„æ–¹æ¡ˆè³‡æ–™åˆ†å¸ƒ")
st.pyplot(fig1)

# =================================================
# E. å–®å› å­ ANOVA
# =================================================
st.subheader("å››ã€ANOVA æª¢å®š")

F_stat, p_value = f_oneway(group_A, group_B, group_C)

st.write(f"**F å€¼ = {F_stat:.3f}**")
st.write(f"**p-value = {p_value:.4f}**")

# =================================================
# F. å·¥ç¨‹åˆ¤æ–·
# =================================================
st.subheader("äº”ã€å·¥ç¨‹æ±ºç­–")

if p_value < alpha:
    st.success("""
âœ… è‡³å°‘æœ‰ä¸€å€‹æ–¹æ¡ˆçš„å¹³å‡è¡¨ç¾ä¸åŒ  
ğŸ‘‰ å·®ç•°ä¸»è¦ä¾†è‡ªã€Œæ–¹æ¡ˆé¸æ“‡ã€
""")
else:
    st.warning("""
âš ï¸ ç„¡è¶³å¤ è­‰æ“šé¡¯ç¤ºæ–¹æ¡ˆé–“å·®ç•°  
ğŸ‘‰ è§€å¯Ÿåˆ°çš„å·®ç•°å¯èƒ½åªæ˜¯èª¤å·®
""")

# =================================================
# G. å·¥ç¨‹åæ€ï¼ˆé—œéµï¼‰
# =================================================
st.subheader("å…­ã€å·¥ç¨‹åæ€")

st.markdown("""
è«‹è¨è«–ï¼š

1. ANOVA å‘Šè¨´ä½ ã€Œå“ªå€‹æ–¹æ¡ˆæœ€å¥½ã€å—ï¼Ÿ
2. å¦‚æœ p-value å¾ˆå°ï¼Œä½†å·®ç•°å¾ˆå°ï¼Œå·¥ç¨‹ä¸Šé‡è¦å—ï¼Ÿ
3. ä½ æœƒåªæ†‘çµ±è¨ˆçµæœé¸æ–¹æ¡ˆå—ï¼Ÿ
""")

st.info("""
ğŸ“Œ æœ¬é€±ä½ å­¸åˆ°çš„ä¸æ˜¯é¸ç­”æ¡ˆ  
ğŸ“Œ è€Œæ˜¯ç¸®å°å·¥ç¨‹æ±ºç­–çš„ä¸ç¢ºå®šæ€§

ä¸‹é€±å°‡é€²å…¥ï¼š  
ğŸ‘‰ **å¤šé‡æ¯”è¼ƒèˆ‡å¯¦é©—è¨­è¨ˆ**
""")
